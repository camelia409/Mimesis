{% extends "base.html" %}

{% block title %}Mimesis - Your Style Identity{% endblock %}

{% block content %}
<!-- Hero Section with Results -->
<section class="relative min-h-screen flex items-center justify-center overflow-hidden py-8 sm:py-12 lg:py-20">
    <!-- Background Elements -->
    <div class="absolute inset-0">
        <div class="absolute top-10 left-10 sm:top-20 sm:left-20 w-32 h-32 sm:w-72 sm:h-72 bg-purple-500/20 rounded-full blur-3xl animate-float"></div>
        <div class="absolute bottom-10 right-10 sm:bottom-20 sm:right-20 w-40 h-40 sm:w-96 sm:h-96 bg-pink-500/20 rounded-full blur-3xl animate-float" style="animation-delay: 2s;"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-48 h-48 sm:w-80 sm:h-80 bg-blue-500/10 rounded-full blur-3xl animate-float" style="animation-delay: 4s;"></div>
    </div>

    <div class="relative z-10 w-full max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header Section -->
        <div class="text-center mb-8 sm:mb-12">
            <h1 class="text-3xl sm:text-5xl md:text-6xl lg:text-7xl font-black text-gradient font-space mb-4 sm:mb-8 leading-tight">
                Your
                <span class="block shimmer bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 bg-clip-text text-transparent">
                    Style Identity
                </span>
                Revealed
            </h1>
            <p class="text-lg sm:text-xl md:text-2xl text-white/80 font-medium max-w-4xl mx-auto leading-relaxed px-4">
                AI-powered fashion recommendations that understand your cultural background
            </p>
        </div>

        <!-- User Input Display -->
        <div class="glass-effect rounded-2xl sm:rounded-3xl p-6 sm:p-8 lg:p-10 mb-8 sm:mb-12 border border-white/10 card-hover">
            <div class="text-center">
                <h2 class="text-2xl sm:text-3xl font-bold text-white mb-4 sm:mb-6">
                    <i class="fas fa-quote-left text-purple-400 mr-2 sm:mr-3"></i>
                    Your Cultural Input
                </h2>
                <div class="bg-white/5 rounded-xl sm:rounded-2xl p-4 sm:p-6 lg:p-8 border border-white/20">
                    <p class="text-lg sm:text-xl lg:text-2xl italic break-words text-white/90">"{{ user_input }}"</p>
                </div>
                <a href="{{ url_for('index') }}" class="mt-6 sm:mt-8 inline-flex items-center bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl sm:rounded-2xl font-semibold hover:from-purple-700 hover:to-pink-700 transition-all duration-300 hover:scale-105 animate-glow group">
                    <i class="fas fa-arrow-left mr-2 sm:mr-3 group-hover:-translate-x-1 transition-transform"></i>
                    Try Another Style
                </a>
            </div>
        </div>

        {% if not recommendations.success %}
            <!-- Error Display -->
            <div class="glass-effect rounded-2xl sm:rounded-3xl p-6 sm:p-8 lg:p-10 mb-8 sm:mb-12 border border-red-500/30 card-hover">
                <div class="text-center">
                    <div class="w-16 h-16 sm:w-20 sm:h-20 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4 sm:mb-6">
                        <i class="fas fa-exclamation-triangle text-red-400 text-2xl sm:text-3xl"></i>
                    </div>
                    <h3 class="text-2xl sm:text-3xl font-bold text-red-400 mb-3 sm:mb-4">Oops! Something went wrong</h3>
                    <p class="text-white/80 mb-6 sm:mb-8 text-base sm:text-lg lg:text-xl">{{ recommendations.error }}</p>
                    <button onclick="window.location.reload()" class="bg-red-600 hover:bg-red-700 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl sm:rounded-2xl font-semibold transition-all duration-300 hover:scale-105">
                        <i class="fas fa-redo mr-2 sm:mr-3"></i>Try Again
                    </button>
                </div>
            </div>
        {% else %}
            <!-- Main Aesthetic Identity -->
            <div class="glass-effect rounded-2xl sm:rounded-3xl p-6 sm:p-8 lg:p-12 mb-8 sm:mb-12 border border-white/10 card-hover text-center">
                <div class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-6 sm:mb-8 animate-glow">
                    <i class="fas fa-crown text-white text-2xl sm:text-3xl lg:text-4xl"></i>
                </div>
                <h2 class="text-3xl sm:text-4xl md:text-5xl font-black text-gradient font-space mb-4 sm:mb-6">{{ recommendations.aesthetic_name }}</h2>
                <p class="text-lg sm:text-xl lg:text-2xl text-white/80 max-w-3xl mx-auto">Your unique cultural style identity, tailored to your preferences and history.</p>
            </div>

            <!-- Brand Recommendations -->
            <div class="glass-effect rounded-2xl sm:rounded-3xl p-6 sm:p-8 lg:p-12 mb-8 sm:mb-12 border border-white/10 card-hover">
                <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-6 sm:mb-8 text-center">
                    <i class="fas fa-tags text-purple-400 mr-2 sm:mr-4"></i>
                    Curated Brands
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
                    {% for brand in recommendations.brands %}
                        <div class="bg-white/5 rounded-xl sm:rounded-2xl p-4 sm:p-6 lg:p-8 border border-white/20 hover:border-purple-500/50 transition-all duration-300 group hover:scale-105">
                            <div class="flex items-center mb-3 sm:mb-4">
                                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg sm:rounded-xl flex items-center justify-center mr-3 sm:mr-4 group-hover:scale-110 transition-transform">
                                    {% if brand.startswith('@') %}
                                        <i class="fab fa-instagram text-white text-lg sm:text-xl"></i>
                                    {% elif 'thrift' in brand.lower() or 'vintage' in brand.lower() %}
                                        <i class="fas fa-recycle text-white text-lg sm:text-xl"></i>
                                    {% elif 'diy' in brand.lower() or 'upcycle' in brand.lower() %}
                                        <i class="fas fa-paint-brush text-white text-lg sm:text-xl"></i>
                                    {% else %}
                                        <i class="fas fa-store text-white text-lg sm:text-xl"></i>
                                    {% endif %}
                                </div>
                                <span class="font-bold text-lg sm:text-xl text-white">{{ brand }}</span>
                            </div>
                            <p class="text-white/70 text-sm sm:text-base lg:text-lg">
                                {% if brand.startswith('@') %}
                                    <i class="fab fa-instagram mr-2"></i>Instagram Boutique
                                {% elif 'thrift' in brand.lower() or 'vintage' in brand.lower() %}
                                    <i class="fas fa-leaf mr-2"></i>Sustainable & Eco-Friendly
                                {% elif 'diy' in brand.lower() or 'upcycle' in brand.lower() %}
                                    <i class="fas fa-magic mr-2"></i>Creative DIY Project
                                {% else %}
                                    <i class="fas fa-globe mr-2"></i>Global Fashion Brand
                                {% endif %}
                            </p>
                        </div>
                    {% endfor %}
                </div>
                <div class="mt-8 sm:mt-10 p-4 sm:p-6 lg:p-8 bg-gradient-to-r from-purple-600/20 to-pink-600/20 rounded-xl sm:rounded-2xl border border-purple-500/30">
                    <h4 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-white">
                        <i class="fas fa-lightbulb text-purple-400 mr-2 sm:mr-3"></i>
                        Personalized Brand Strategy
                    </h4>
                    <p class="text-white/80 text-base sm:text-lg leading-relaxed">
                        These brands are carefully selected to match your unique aesthetic identity. 
                        We include diverse options from luxury to thrift, ensuring you can express your style 
                        at any budget while supporting sustainable and inclusive fashion.
                    </p>
                </div>
            </div>

            <!-- Signature Outfit -->
            <div class="glass-effect rounded-2xl sm:rounded-3xl p-6 sm:p-8 lg:p-12 mb-8 sm:mb-12 border border-white/10 card-hover">
                <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-6 sm:mb-8 text-center">
                    <i class="fas fa-tshirt text-purple-400 mr-2 sm:mr-4"></i>
                    Signature Outfit
                </h3>
                <div class="bg-white/5 rounded-xl sm:rounded-2xl p-4 sm:p-6 lg:p-10 border border-white/20">
                    <div class="prose prose-invert max-w-none text-base sm:text-lg leading-relaxed">
                        {% set outfit_sections = recommendations.outfit.split('\n\n') %}
                        {% for section in outfit_sections %}
                            {% if section.strip() %}
                                <div class="mb-6 sm:mb-8 last:mb-0">
                                    {% set lines = section.split('\n') %}
                                    {% for line in lines %}
                                        {% if line.strip() %}
                                            {% if line.strip().isupper() or line.strip().endswith(':') %}
                                                <h4 class="text-xl sm:text-2xl font-bold text-purple-400 mb-3 sm:mb-4">{{ line.strip() }}</h4>
                                            {% else %}
                                                <p class="text-white/90 mb-2 sm:mb-3 text-base sm:text-lg">{{ line.strip() }}</p>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Style Vision Board -->
            <div class="glass-effect rounded-2xl sm:rounded-3xl p-6 sm:p-8 lg:p-12 mb-8 sm:mb-12 border border-white/10 card-hover">
                <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-6 sm:mb-8 text-center">
                    <i class="fas fa-palette text-purple-400 mr-2 sm:mr-4"></i>
                    Style Vision Board
                </h3>
                <div class="bg-white/5 rounded-xl sm:rounded-2xl p-4 sm:p-6 lg:p-10 border border-white/20">
                    <div class="prose prose-invert max-w-none text-base sm:text-lg leading-relaxed">
                        {% set moodboard_sections = recommendations.moodboard.split('\n\n') %}
                        {% for section in moodboard_sections %}
                            {% if section.strip() %}
                                <div class="mb-6 sm:mb-8 last:mb-0">
                                    {% set lines = section.split('\n') %}
                                    {% for line in lines %}
                                        {% if line.strip() %}
                                            {% if line.strip().isupper() or line.strip().endswith(':') %}
                                                <h4 class="text-xl sm:text-2xl font-bold text-pink-400 mb-3 sm:mb-4">{{ line.strip() }}</h4>
                                            {% else %}
                                                <p class="text-white/90 mb-2 sm:mb-3 text-base sm:text-lg">{{ line.strip() }}</p>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Sustainable Shopping Options -->
            <div class="glass-effect rounded-2xl sm:rounded-3xl p-6 sm:p-8 lg:p-12 mb-8 sm:mb-12 border border-white/10 card-hover">
                <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-6 sm:mb-8 text-center">
                    <i class="fas fa-leaf text-green-400 mr-2 sm:mr-4"></i>
                    Sustainable Shopping Options
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                    <a href="https://www.etsy.com" target="_blank" class="bg-white/10 rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/20 hover:border-green-500/50 transition-all duration-300 group hover:scale-105">
                        <div class="flex items-center">
                            <i class="fas fa-shopping-bag text-green-400 text-2xl sm:text-3xl mr-3 sm:mr-4 group-hover:scale-110 transition-transform"></i>
                            <div>
                                <h4 class="font-bold text-lg sm:text-xl text-white">Etsy</h4>
                                <p class="text-white/70 text-sm sm:text-lg">Handmade & Vintage Finds</p>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.thredup.com" target="_blank" class="bg-white/10 rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/20 hover:border-green-500/50 transition-all duration-300 group hover:scale-105">
                        <div class="flex items-center">
                            <i class="fas fa-recycle text-green-400 text-2xl sm:text-3xl mr-3 sm:mr-4 group-hover:scale-110 transition-transform"></i>
                            <div>
                                <h4 class="font-bold text-lg sm:text-xl text-white">ThredUP</h4>
                                <p class="text-white/70 text-sm sm:text-lg">Secondhand Fashion</p>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.cosstores.com" target="_blank" class="bg-white/10 rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/20 hover:border-green-500/50 transition-all duration-300 group hover:scale-105">
                        <div class="flex items-center">
                            <i class="fas fa-star text-green-400 text-2xl sm:text-3xl mr-3 sm:mr-4 group-hover:scale-110 transition-transform"></i>
                            <div>
                                <h4 class="font-bold text-lg sm:text-xl text-white">COS</h4>
                                <p class="text-white/70 text-sm sm:text-lg">Sustainable Luxury</p>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.depop.com" target="_blank" class="bg-white/10 rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/20 hover:border-green-500/50 transition-all duration-300 group hover:scale-105">
                        <div class="flex items-center">
                            <i class="fas fa-users text-green-400 text-2xl sm:text-3xl mr-3 sm:mr-4 group-hover:scale-110 transition-transform"></i>
                            <div>
                                <h4 class="font-bold text-lg sm:text-xl text-white">Depop</h4>
                                <p class="text-white/70 text-sm sm:text-lg">Community Fashion</p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Share Section -->
            <div class="glass-effect rounded-2xl sm:rounded-3xl p-6 sm:p-8 lg:p-12 mb-8 sm:mb-12 border border-white/10 card-hover">
                <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-6 sm:mb-8 text-center">
                    <i class="fas fa-share-alt text-purple-400 mr-2 sm:mr-4"></i>
                    Share Your Vibe
                </h3>
                <div class="flex flex-col sm:flex-row justify-center gap-4 sm:gap-6">
                    <button onclick="shareStyle('{{ recommendations.aesthetic_name }}', '{{ url_for('index', _external=True) }}')" 
                            class="w-full sm:w-auto bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl sm:rounded-2xl font-semibold hover:from-purple-700 hover:to-pink-700 transition-all duration-300 hover:scale-105">
                        <i class="fas fa-share mr-2 sm:mr-3"></i>Quick Share
                    </button>
                    <button onclick="copyLink('{{ url_for('index', _external=True) }}')" 
                            class="w-full sm:w-auto bg-white/10 hover:bg-white/20 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl sm:rounded-2xl font-semibold transition-all duration-300 hover:scale-105 border border-white/20">
                        <i class="fas fa-link mr-2 sm:mr-3"></i>Copy Link
                    </button>
                </div>
            </div>

            <!-- Feedback Section -->
            <div class="glass-effect rounded-2xl sm:rounded-3xl p-6 sm:p-8 lg:p-12 mb-8 sm:mb-12 border border-white/10 card-hover">
                <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-6 sm:mb-8 text-center">
                    <i class="fas fa-star text-yellow-400 mr-2 sm:mr-4"></i>
                    Rate Your Style Identity
                </h3>
                <form id="rating-form" class="space-y-6 sm:space-y-8">
                    <div class="text-center">
                        <label class="block text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-white">How do you like your style recommendations? (1-5)</label>
                        <div class="flex justify-center space-x-2 sm:space-x-4">
                            {% for i in range(1, 6) %}
                                <input type="radio" id="rating-{{ i }}" name="rating" value="{{ i }}" class="hidden">
                                <label for="rating-{{ i }}" class="cursor-pointer text-4xl sm:text-5xl text-gray-400 hover:text-yellow-400 transition-all duration-300 rating-star hover:scale-125" data-rating="{{ i }}">
                                    <i class="fas fa-star"></i>
                                </label>
                            {% endfor %}
                        </div>
                    </div>
                    <div>
                        <label for="feedback" class="block text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-white">Any thoughts to share? (Optional)</label>
                        <textarea id="feedback" name="feedback" rows="4" 
                                  class="w-full bg-white/10 border border-white/20 rounded-xl sm:rounded-2xl px-4 sm:px-6 py-3 sm:py-4 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base sm:text-lg"
                                  placeholder="Tell us what you loved or how we could improve..."></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="w-full sm:w-auto bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl sm:rounded-2xl font-semibold hover:from-purple-700 hover:to-pink-700 transition-all duration-300 hover:scale-105">
                            <i class="fas fa-paper-plane mr-2 sm:mr-3"></i>Submit Feedback
                        </button>
                    </div>
                </form>
            </div>
        {% endif %}
    </div>
</section>

<script>
    // Share functionality
    function shareStyle(aestheticName, url) {
        if (navigator.share) {
            navigator.share({
                title: `My ${aestheticName} Style on Mimesis`,
                text: `Check out my ${aestheticName} style!`,
                url: url
            }).then(() => console.log("Shared successfully")).catch(error => console.log("Error sharing:", error));
        } else {
            // Fallback for browsers that don't support Web Share API
            const shareText = `Check out my ${aestheticName} style! ${url}`;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert("Share text copied to clipboard!");
                }).catch(() => {
                    prompt("Copy this link to share:", shareText);
                });
            } else {
                prompt("Copy this link to share:", shareText);
            }
        }
    }

    function copyLink(url) {
        navigator.clipboard.writeText(url).then(() => {
            // Show a more mobile-friendly notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded-lg z-50 text-sm sm:text-base';
            notification.textContent = 'Link copied to clipboard!';
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }).catch(() => {
            prompt("Copy this link manually:", url);
        });
    }

    // Rating stars functionality
    document.addEventListener('DOMContentLoaded', function() {
        const ratingStars = document.querySelectorAll('.rating-star');
        
        ratingStars.forEach(star => {
            star.addEventListener('click', function() {
                const rating = parseInt(this.dataset.rating);
                
                // Update radio button
                document.getElementById(`rating-${rating}`).checked = true;
                
                // Update star display
                ratingStars.forEach((s, index) => {
                    if (index < rating) {
                        s.classList.remove('text-gray-400');
                        s.classList.add('text-yellow-400');
                    } else {
                        s.classList.remove('text-yellow-400');
                        s.classList.add('text-gray-400');
                    }
                });
            });
        });
    });

    // Feedback form submission
    document.getElementById("rating-form").addEventListener("submit", function(e) {
        e.preventDefault();
        const rating = document.querySelector('input[name="rating"]:checked')?.value;
        const feedback = document.getElementById("feedback").value;
        
        if (!rating) {
            // Show mobile-friendly alert
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded-lg z-50 text-sm sm:text-base';
            notification.textContent = 'Please select a rating.';
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
            return;
        }
        
        // Send feedback to server
        const formData = new FormData();
        formData.append('request_id', '{{ request_id }}');
        formData.append('rating', rating);
        formData.append('feedback', feedback);
        
        fetch('/feedback', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show success notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded-lg z-50 text-sm sm:text-base';
                notification.textContent = 'Thank you for your feedback!';
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.remove();
                }, 3000);
                
                // Reset form
                document.getElementById("rating-form").reset();
                document.querySelectorAll('.rating-star').forEach(star => {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-400');
                });
            } else {
                // Show error notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded-lg z-50 text-sm sm:text-base';
                notification.textContent = 'Failed to submit feedback. Please try again.';
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            // Show error notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded-lg z-50 text-sm sm:text-base';
            notification.textContent = 'Network error. Please try again.';
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        });
    });

    // Add touch support for better mobile experience
    document.addEventListener('touchstart', function() {}, {passive: true});
    
    // Prevent zoom on double tap for mobile
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    }, false);
</script>
{% endblock %}
