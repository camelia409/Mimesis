{% extends "base.html" %}

{% block title %}Your Style Identity - Mimesis{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="relative py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Back Navigation -->
        <div class="mb-8">
            <a href="{{ url_for('index') }}" class="inline-flex items-center text-white/60 hover:text-white transition-all duration-300 hover:scale-105">
                <i class="fas fa-arrow-left mr-3 text-lg"></i>
                <span class="text-lg font-medium">Try Another Style</span>
            </a>
        </div>

        <!-- User Input Display -->
        <div class="glass-effect rounded-3xl p-8 border border-white/10 mb-12 card-hover">
            <div class="text-center">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-quote-left text-purple-400 mr-3"></i>
                    Your Cultural Input
                </h2>
                <div class="bg-white/5 rounded-2xl p-6 border border-white/10">
                    <p class="text-white/90 text-xl italic break-words">"{{ user_input }}"</p>
                </div>
            </div>
        </div>

        {% if recommendations.success %}
        <!-- Main Aesthetic Identity -->
        <div class="text-center mb-16">
            <div class="glass-effect rounded-3xl p-12 border border-white/10 card-hover">
                <div class="w-24 h-24 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-8 animate-glow">
                    <i class="fas fa-crown text-white text-4xl"></i>
                </div>
                <h1 class="text-5xl font-black text-gradient font-space mb-6">{{ recommendations.aesthetic_name }}</h1>
                <p class="text-white/70 text-xl">Your unique cultural style identity</p>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-16">
            <!-- Brand Suggestions -->
            <div class="glass-effect rounded-3xl p-10 border border-white/10 card-hover">
                <h3 class="text-3xl font-bold text-white mb-8">
                    <i class="fas fa-tags text-purple-400 mr-3"></i>
                    Curated Brands
                </h3>
                {% if recommendations.brands %}
                    <div class="space-y-6">
                        {% for brand in recommendations.brands %}
                            <div class="bg-white/5 rounded-2xl p-6 border border-white/10 hover:border-purple-500/30 transition-all duration-300 hover:scale-105">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl flex items-center justify-center mr-4">
                                        {% if brand.startswith('@') %}
                                            <i class="fab fa-instagram text-white text-xl"></i>
                                        {% elif 'thrift' in brand.lower() or 'vintage' in brand.lower() %}
                                            <i class="fas fa-recycle text-white text-xl"></i>
                                        {% elif 'diy' in brand.lower() or 'upcycle' in brand.lower() %}
                                            <i class="fas fa-paint-brush text-white text-xl"></i>
                                        {% else %}
                                            <i class="fas fa-store text-white text-xl"></i>
                                        {% endif %}
                                    </div>
                                    <div class="flex-1">
                                        <span class="text-white font-semibold text-lg">{{ brand }}</span>
                                        {% if brand.startswith('@') %}
                                            <p class="text-purple-400 text-sm mt-1">
                                                <i class="fab fa-instagram mr-1"></i>Instagram Boutique
                                            </p>
                                        {% elif 'thrift' in brand.lower() or 'vintage' in brand.lower() %}
                                            <p class="text-green-400 text-sm mt-1">
                                                <i class="fas fa-leaf mr-1"></i>Sustainable & Eco-Friendly
                                            </p>
                                        {% elif 'diy' in brand.lower() or 'upcycle' in brand.lower() %}
                                            <p class="text-orange-400 text-sm mt-1">
                                                <i class="fas fa-magic mr-1"></i>Creative DIY Project
                                            </p>
                                        {% else %}
                                            <p class="text-white/60 text-sm mt-1">
                                                <i class="fas fa-globe mr-1"></i>Global Fashion Brand
                                            </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-white/60 italic text-lg">No brand suggestions available</p>
                {% endif %}
                
                <div class="mt-8 p-6 bg-gradient-to-r from-purple-600/20 to-pink-600/20 rounded-2xl border border-purple-500/30">
                    <h4 class="text-lg font-semibold text-white mb-3">
                        <i class="fas fa-lightbulb text-purple-400 mr-2"></i>
                        Personalized Brand Strategy
                    </h4>
                    <p class="text-white/80 text-base leading-relaxed">
                        These brands are carefully selected to match your unique aesthetic identity. 
                        We include diverse options from luxury to thrift, ensuring you can express your style at any budget while supporting sustainable and inclusive fashion.
                    </p>
                </div>
            </div>

            <!-- Signature Outfit -->
            <div class="glass-effect rounded-3xl p-10 border border-white/10 card-hover">
                <h3 class="text-3xl font-bold text-white mb-8">
                    <i class="fas fa-tshirt text-purple-400 mr-3"></i>
                    Signature Outfit
                </h3>
                <div class="bg-gradient-to-br from-purple-600/20 to-pink-600/20 rounded-2xl p-8 border border-purple-500/30">
                    <p class="text-white/90 text-lg leading-relaxed">{{ recommendations.outfit }}</p>
                </div>
                <div class="mt-6 flex items-center text-white/60">
                    <i class="fas fa-info-circle mr-3 text-purple-400 flex-shrink-0"></i>
                    <span class="text-base">This outfit captures the essence of your cultural influences through carefully selected pieces and styling.</span>
                </div>
            </div>
        </div>

        <!-- Moodboard Section -->
        <div class="glass-effect rounded-3xl p-10 border border-white/10 mb-16 card-hover">
            <h3 class="text-3xl font-bold text-white mb-8">
                <i class="fas fa-palette text-purple-400 mr-3"></i>
                Aesthetic Moodboard
            </h3>
            <div class="bg-gradient-to-br from-purple-600/20 to-pink-600/20 rounded-2xl p-8 border border-purple-500/30">
                <p class="text-white/90 text-lg leading-relaxed mb-6">{{ recommendations.moodboard }}</p>
                <div class="p-6 bg-white/5 rounded-2xl border border-white/10">
                    <h4 class="text-lg font-semibold text-white mb-3">
                        <i class="fas fa-lightbulb text-purple-400 mr-2"></i>
                        Visual Inspiration Guide
                    </h4>
                    <p class="text-white/70 text-base leading-relaxed">
                        Use this description to create your own moodboard, find inspiration on Pinterest, or guide your shopping decisions. 
                        The aesthetic captures the essence of your cultural influences through colors, textures, and themes.
                    </p>
                </div>
            </div>
        </div>

        <!-- Style Inspiration Grid -->
        <div class="glass-effect rounded-3xl p-10 border border-white/10 mb-16 card-hover">
            <h3 class="text-3xl font-bold text-white mb-8">
                <i class="fas fa-magic text-purple-400 mr-3"></i>
                Style Inspiration & Tips
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Cultural Context -->
                <div class="bg-gradient-to-br from-blue-600/20 to-indigo-600/20 rounded-2xl p-6 border border-blue-500/30">
                    <h4 class="text-xl font-semibold text-white mb-4">
                        <i class="fas fa-globe text-blue-400 mr-2"></i>
                        Cultural Context
                    </h4>
                    <p class="text-white/80 text-base leading-relaxed">
                        Your style identity draws from diverse cultural influences, creating a unique fusion that celebrates global aesthetics. 
                        This approach honors the rich traditions and contemporary expressions that shape your personal style journey.
                    </p>
                </div>
                
                <!-- Sustainability Focus -->
                <div class="bg-gradient-to-br from-green-600/20 to-emerald-600/20 rounded-2xl p-6 border border-green-500/30">
                    <h4 class="text-xl font-semibold text-white mb-4">
                        <i class="fas fa-leaf text-green-400 mr-2"></i>
                        Sustainable Style
                    </h4>
                    <p class="text-white/80 text-base leading-relaxed">
                        Embrace thrift shopping, vintage finds, and DIY projects to build your aesthetic sustainably. 
                        Mix high-end pieces with affordable alternatives to create a unique, eco-conscious wardrobe.
                    </p>
                </div>
                
                <!-- Personal Expression -->
                <div class="bg-gradient-to-br from-purple-600/20 to-pink-600/20 rounded-2xl p-6 border border-purple-500/30">
                    <h4 class="text-xl font-semibold text-white mb-4">
                        <i class="fas fa-heart text-purple-400 mr-2"></i>
                        Personal Expression
                    </h4>
                    <p class="text-white/80 text-base leading-relaxed">
                        Your style is a reflection of your cultural journey and personal story. 
                        Don't be afraid to experiment, mix different elements, and make the aesthetic truly your own.
                    </p>
                </div>
                
                <!-- Shopping Strategy -->
                <div class="bg-gradient-to-br from-orange-600/20 to-amber-600/20 rounded-2xl p-6 border border-orange-500/30">
                    <h4 class="text-xl font-semibold text-white mb-4">
                        <i class="fas fa-shopping-bag text-orange-400 mr-2"></i>
                        Shopping Strategy
                    </h4>
                    <p class="text-white/80 text-base leading-relaxed">
                        Start with key pieces that embody your aesthetic, then build around them. 
                        Look for items that can be styled multiple ways and invest in quality over quantity.
                    </p>
                </div>
            </div>
        </div>

        <!-- AI Stylist Chat -->
        <div class="glass-effect rounded-3xl p-10 border border-white/10 mb-16 card-hover">
            <h3 class="text-3xl font-bold text-white mb-8">
                <i class="fas fa-comments text-purple-400 mr-3"></i>
                Ask Your AI Stylist
            </h3>
            <p class="text-white/70 text-lg mb-8">Have questions about your style? Want suggestions for specific occasions? Chat with your AI stylist!</p>
            
            <div class="space-y-6">
                <!-- Chat Input -->
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <input 
                        type="text" 
                        id="chat-input" 
                        placeholder="E.g., 'What shoes would work with this?' or 'Berlin rave outfit ideas?'"
                        class="flex-1 px-6 py-4 bg-white/5 border border-white/20 rounded-2xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent backdrop-blur-sm text-lg"
                        onkeypress="if(event.key==='Enter') sendChat('{{ request_id }}')"
                    >
                    <button 
                        onclick="sendChat('{{ request_id }}')" 
                        class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-2xl font-semibold hover:from-purple-700 hover:to-pink-700 transition-all duration-300 hover:scale-105 animate-glow text-lg"
                    >
                        <i class="fas fa-paper-plane mr-2"></i>
                        Send
                    </button>
                </div>
                
                <!-- Chat Output -->
                <div id="chat-output" class="hidden">
                    <div class="bg-purple-600/20 border-l-4 border-purple-500 p-6 rounded-2xl">
                        <div class="flex items-start space-x-4">
                            <i class="fas fa-robot text-purple-400 text-2xl mt-1 flex-shrink-0"></i>
                            <div class="flex-1 min-w-0">
                                <p class="font-semibold text-white mb-2 text-lg">Your AI Stylist</p>
                                <p id="chat-response" class="text-white/90 text-lg"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Welcome Message -->
                <div id="chat-welcome" class="bg-blue-600/20 border-l-4 border-blue-500 p-6 rounded-2xl">
                    <div class="flex items-start space-x-4">
                        <i class="fas fa-robot text-blue-400 text-2xl mt-1"></i>
                        <div>
                            <p class="font-semibold text-white mb-2 text-lg">Your AI Stylist</p>
                            <p class="text-white/90 text-lg">Hi! I'm here to help you explore your unique style identity. Ask me about accessories, makeup, sustainable options, or any fashion questions you have!</p>
                        </div>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="chat-loading" class="hidden">
                    <div class="bg-white/5 border border-white/20 p-6 rounded-2xl">
                        <div class="flex items-center space-x-4">
                            <div class="animate-spin rounded-full h-6 w-6 border-2 border-purple-600 border-t-transparent"></div>
                            <p class="text-white/70 text-lg">Your stylist is thinking...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Questions -->
                <div class="flex flex-wrap gap-3">
                    <button onclick="quickChat('What accessories would complete this look?', '{{ request_id }}')" 
                            class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-xl transition-all duration-300 hover:scale-105 text-base">
                        Accessories?
                    </button>
                    <button onclick="quickChat('What makeup would match this aesthetic?', '{{ request_id }}')" 
                            class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-xl transition-all duration-300 hover:scale-105 text-base">
                        Makeup ideas?
                    </button>
                    <button onclick="quickChat('How can I make this more sustainable?', '{{ request_id }}')" 
                            class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-xl transition-all duration-300 hover:scale-105 text-base">
                        Sustainable options?
                    </button>
                </div>
            </div>
        </div>

        <!-- Social Media Integration -->
        <div class="glass-effect rounded-3xl p-10 border border-white/10 mb-16 card-hover">
            <h3 class="text-3xl font-bold text-white mb-8">
                <i class="fas fa-share-alt text-purple-400 mr-3"></i>
                Share Your Vibe
            </h3>
            <p class="text-white/70 text-lg mb-8">Show off your unique aesthetic identity with your friends!</p>
            
            <div class="flex flex-col sm:flex-row gap-6">
                <button onclick="shareToInstagram('{{ recommendations.aesthetic_name }}')" 
                        class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-8 py-4 rounded-2xl font-semibold transition-all duration-300 hover:scale-105 animate-glow flex items-center justify-center text-lg">
                    <i class="fab fa-instagram mr-3 text-2xl"></i>
                    Share on Instagram
                </button>
                <button onclick="copyStyleURL()" 
                        class="bg-white/10 hover:bg-white/20 text-white px-8 py-4 rounded-2xl font-semibold transition-all duration-300 hover:scale-105 flex items-center justify-center text-lg">
                    <i class="fas fa-link mr-3"></i>
                    Copy Link
                </button>
            </div>
            
            <!-- Share preview -->
            <div id="share-preview" class="mt-6 hidden">
                <div class="bg-white/5 border border-white/20 p-6 rounded-2xl">
                    <p class="text-white/60 text-base mb-3">Share text preview:</p>
                    <p id="share-text" class="text-white font-medium text-lg break-words"></p>
                </div>
            </div>
        </div>

        <!-- User Feedback Section -->
        <div class="glass-effect rounded-3xl p-10 border border-white/10 mb-16 card-hover">
            <h3 class="text-3xl font-bold text-white mb-8">
                <i class="fas fa-star text-purple-400 mr-3"></i>
                Rate Your Style Identity
            </h3>
            <form id="feedback-form" class="space-y-6">
                <input type="hidden" id="request-id" value="{{ request_id }}">
                
                <!-- Star Rating -->
                <div>
                    <label class="block text-lg font-medium text-white mb-4">How do you like your style recommendations?</label>
                    <div class="flex space-x-2" id="star-rating">
                        <button type="button" class="star-btn text-3xl text-white/30 hover:text-yellow-400 transition-all duration-300 hover:scale-110" data-rating="1">
                            <i class="fas fa-star"></i>
                        </button>
                        <button type="button" class="star-btn text-3xl text-white/30 hover:text-yellow-400 transition-all duration-300 hover:scale-110" data-rating="2">
                            <i class="fas fa-star"></i>
                        </button>
                        <button type="button" class="star-btn text-3xl text-white/30 hover:text-yellow-400 transition-all duration-300 hover:scale-110" data-rating="3">
                            <i class="fas fa-star"></i>
                        </button>
                        <button type="button" class="star-btn text-3xl text-white/30 hover:text-yellow-400 transition-all duration-300 hover:scale-110" data-rating="4">
                            <i class="fas fa-star"></i>
                        </button>
                        <button type="button" class="star-btn text-3xl text-white/30 hover:text-yellow-400 transition-all duration-300 hover:scale-110" data-rating="5">
                            <i class="fas fa-star"></i>
                        </button>
                    </div>
                    <input type="hidden" id="rating-value" name="rating" value="">
                </div>
                
                <!-- Optional Comment -->
                <div>
                    <label for="feedback-text" class="block text-lg font-medium text-white mb-4">
                        Any thoughts to share? (Optional)
                    </label>
                    <textarea 
                        id="feedback-text" 
                        name="feedback" 
                        rows="4" 
                        class="w-full px-6 py-4 bg-white/5 border border-white/20 rounded-2xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent backdrop-blur-sm text-lg"
                        placeholder="Tell us what you loved or how we could improve..."
                    ></textarea>
                </div>
                
                <button 
                    type="submit" 
                    id="feedback-submit"
                    class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-8 py-4 rounded-2xl font-semibold transition-all duration-300 hover:scale-105 animate-glow disabled:opacity-50 text-lg"
                    disabled
                >
                    <i class="fas fa-heart mr-3"></i>
                    Submit Feedback
                </button>
            </form>
            
            <div id="feedback-response" class="mt-6 hidden">
                <div class="bg-green-600/20 border-l-4 border-green-500 p-6 rounded-2xl">
                    <p class="text-white font-semibold text-lg">
                        <i class="fas fa-check-circle mr-3"></i>
                        Thank you for your feedback!
                    </p>
                </div>
            </div>
        </div>

        {% else %}
        <!-- Error state -->
        <div class="glass-effect rounded-3xl p-12 border border-red-500/30 text-center">
            <div class="w-24 h-24 bg-gradient-to-r from-red-600 to-red-800 rounded-full flex items-center justify-center mx-auto mb-8 animate-glow">
                <i class="fas fa-exclamation-triangle text-white text-4xl"></i>
            </div>
            <h2 class="text-3xl font-bold text-white mb-6">Unable to Generate Recommendations</h2>
            <p class="text-white/70 text-xl mb-8">{{ recommendations.error or "An unexpected error occurred while processing your cultural preferences." }}</p>
            <a href="{{ url_for('index') }}" class="bg-gradient-to-r from-red-600 to-red-800 text-white px-8 py-4 rounded-2xl font-semibold hover:from-red-700 hover:to-red-900 transition-all duration-300 hover:scale-105 animate-glow text-lg">
                <i class="fas fa-redo mr-3"></i>
                Try Again
            </a>
        </div>
        {% endif %}

        <!-- Debug information (only shown in development) -->
        {% if config.DEBUG %}
        <div class="mt-16 glass-effect rounded-3xl p-8 border border-white/10">
            <h4 class="font-semibold text-white mb-4 text-lg">Debug Information</h4>
            <details class="text-base">
                <summary class="cursor-pointer text-white/70 hover:text-white">View API Responses</summary>
                <div class="mt-4 space-y-4">
                    <div>
                        <strong class="text-white">Qloo Data:</strong>
                        <pre class="bg-white/5 p-4 rounded-2xl text-sm overflow-auto max-h-60 text-white/80">{{ qloo_data | tojson(indent=2) }}</pre>
                    </div>
                    <div>
                        <strong class="text-white">Gemini Recommendations:</strong>
                        <pre class="bg-white/5 p-4 rounded-2xl text-sm overflow-auto max-h-60 text-white/80">{{ recommendations | tojson(indent=2) }}</pre>
                    </div>
                </div>
            </details>
        </div>
        {% endif %}
    </div>
</section>

<!-- JavaScript Functions -->
<script>
// Star rating functionality
document.addEventListener('DOMContentLoaded', function() {
    const stars = document.querySelectorAll('.star-btn');
    const ratingInput = document.getElementById('rating-value');
    const submitBtn = document.getElementById('feedback-submit');
    
    stars.forEach((star, index) => {
        star.addEventListener('click', function() {
            const rating = parseInt(this.dataset.rating);
            ratingInput.value = rating;
            
            // Update visual state
            stars.forEach((s, i) => {
                if (i < rating) {
                    s.classList.remove('text-white/30');
                    s.classList.add('text-yellow-400');
                } else {
                    s.classList.remove('text-yellow-400');
                    s.classList.add('text-white/30');
                }
            });
            
            // Enable submit button
            submitBtn.disabled = false;
        });
    });
    
    // Handle form submission
    document.getElementById('feedback-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('request_id', document.getElementById('request-id').value);
        formData.append('rating', ratingInput.value);
        formData.append('feedback', document.getElementById('feedback-text').value);
        
        fetch('/feedback', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                document.getElementById('feedback-form').style.display = 'none';
                document.getElementById('feedback-response').classList.remove('hidden');
            } else {
                alert('Error submitting feedback: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            alert('Error submitting feedback: ' + error.message);
        });
    });
});

// Enhanced Chat functionality
async function sendChat(styleRequestId) {
    const input = document.getElementById('chat-input');
    const output = document.getElementById('chat-output');
    const loading = document.getElementById('chat-loading');
    const response = document.getElementById('chat-response');
    
    const message = input.value.trim();
    if (!message) {
        alert('Please enter a message.');
        return;
    }
    
    // Show loading state
    output.classList.add('hidden');
    loading.classList.remove('hidden');
    
    try {
        const formData = new FormData();
        formData.append('chat_input', message);
        formData.append('style_request_id', styleRequestId);
        
        const chatResponse = await fetch('/chat', {
            method: 'POST',
            body: formData
        });
        
        const data = await chatResponse.json();
        
        // Hide loading state
        loading.classList.add('hidden');
        
        if (data.status === 'success') {
            response.textContent = data.response;
            output.classList.remove('hidden');
            document.getElementById('chat-welcome').classList.add('hidden');
            input.value = ''; // Clear input
        } else {
            // Show error in the chat response area instead of alert
            response.textContent = data.error || 'I\'m having trouble responding right now. Please try again!';
            output.classList.remove('hidden');
            document.getElementById('chat-welcome').classList.add('hidden');
        }
    } catch (error) {
        loading.classList.add('hidden');
        // Show error in the chat response area instead of alert
        response.textContent = 'I\'m having trouble responding right now. Please try again!';
        output.classList.remove('hidden');
        document.getElementById('chat-welcome').classList.add('hidden');
    }
}

// Quick chat function
function quickChat(message, styleRequestId) {
    document.getElementById('chat-input').value = message;
    sendChat(styleRequestId);
}

// Instagram Sharing Integration
function shareToInstagram(aestheticName) {
    const shareText = `Just discovered my aesthetic identity: ${aestheticName}! âœ¨\n\nFind your unique style vibe with Mimesis - the cultural style intelligence engine that understands your cultural DNA.\n\n#MimesisStyle #AestheticIdentity #StyleAI #CulturalFashion #PersonalStyle #AestheticVibes #FashionTech #AIStyler`;
    
    // Show preview
    const preview = document.getElementById('share-preview');
    const previewText = document.getElementById('share-text');
    previewText.textContent = shareText;
    preview.classList.remove('hidden');
    
    // Try to open Instagram with pre-filled content
    try {
        // Create Instagram sharing URL (this will redirect to Instagram app or web)
        const instagramUrl = `https://www.instagram.com/?text=${encodeURIComponent(shareText)}`;
        
        // Show user instructions
        setTimeout(() => {
            const message = `ðŸ“± Instagram Sharing Ready!\n\n"${shareText}"\n\nInstructions:\n1. Instagram will open in a new tab\n2. Copy the text above\n3. Create a new post or story\n4. Paste the text and add your style photos\n5. Share your aesthetic identity!`;
            
            if (confirm(message + '\n\nClick OK to open Instagram, or Cancel to just copy the text.')) {
                window.open(instagramUrl, '_blank');
            } else {
                // Copy text to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Share text copied to clipboard! You can now paste it in Instagram.');
                }).catch(() => {
                    alert('Share text ready! Please copy manually:\n\n' + shareText);
                });
            }
        }, 500);
        
    } catch (error) {
        // Fallback: just copy to clipboard
        navigator.clipboard.writeText(shareText).then(() => {
            alert('Share text copied to clipboard! Open Instagram and paste it in your post.');
        }).catch(() => {
            alert('Share text ready! Please copy manually:\n\n' + shareText);
        });
    }
}

// Copy style URL
function copyStyleURL() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
        const preview = document.getElementById('share-preview');
        const previewText = document.getElementById('share-text');
        previewText.textContent = `Style URL copied! ${url}`;
        preview.classList.remove('hidden');
        
        setTimeout(() => {
            preview.classList.add('hidden');
        }, 3000);
    }).catch(() => {
        alert('Could not copy URL. Please copy manually: ' + url);
    });
}

// Focus management for accessibility
document.addEventListener('DOMContentLoaded', () => {
    // Announce the aesthetic name to screen readers
    const aestheticName = document.querySelector('h1');
    if (aestheticName) {
        aestheticName.setAttribute('aria-live', 'polite');
        aestheticName.setAttribute('aria-label', `Your aesthetic identity is ${aestheticName.textContent}`);
    }
});
</script>
{% endblock %}
